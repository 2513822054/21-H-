#include "IIR.h"

//此处填入IIR系数
//float PARA[6*7]=
//{
//1,  0,  -1,1,  1.841743360038588406268900143913924694061,  -0.997681330632437912697696447139605879784,
//1,  0,  -1,1,  1.849477097574939721269515757740009576082,  -0.99773684341505219919099545222707092762,
//1,  0,  -1,1,  1.838693749035915203648983151651918888092,  -0.993532053842735018989174022863153368235,
//1,  0,  -1,1,  1.844956735816695614360583022062201052904,  -0.993656285355919210999786628235597163439,
//1,  0,  -1,1,  1.837474612752936664605840633157640695572,  -0.99070670232084079298573442429187707603,
//1,  0,  -1,1,  1.840973583759110798752089976915158331394,  -0.990806053572604206181040353840216994286,
//1,  0,  -1,1,  1.838299326509701181464606634108349680901,  -0.989745510529960625945022911764681339264,
//};


/*
 // 16k采样   950 990 1010 1050
float PARA[6*7]=
{
		1 , 0  ,-1  ,  1.841743360038588406268900143913924694061 , -0.997681330632437912697696447139605879784,
		1 , 0  ,-1  ,  1.849477097574939721269515757740009576082 , -0.99773684341505219919099545222707092762,
		1 , 0  ,-1   , 1.838693749035915203648983151651918888092 , -0.993532053842735018989174022863153368235,
		1 , 0  ,-1   , 1.844956735816695614360583022062201052904 , -0.993656285355919210999786628235597163439,
		1 , 0 , -1  ,  1.837474612752936664605840633157640695572 , -0.99070670232084079298573442429187707603,
		1 , 0  ,-1  ,  1.840973583759110798752089976915158331394 , -0.990806053572604206181040353840216994286,
		1 , 0 , -1  ,  1.838299326509701181464606634108349680901 , -0.989745510529960625945022911764681339264
};
float IIR_BUF[320*7];

double IIR_SCALE =0.005147700575183133606116392400053882739*
		0.005147700575183133606116392400053882739*
		0.00513712038569738918547535888592392439*
		0.00513712038569738918547535888592392439*
		0.005129836744631849701492321003115648637*
		0.005129836744631849701492321003115648637*
		0.005127244735019647128848596651096158894;
uint16_t STAGE = 7;
*/

 //990 999 1001 1010
float PARA[6*7]=
{
		1,  0 , -1 ,   1.846953556457258116552111459895968437195 , -0.999616659509444671627420575532596558332,
		1 , 0 , -1 ,   1.847856261176185288519491223269142210484 , -0.999617748274743145309173542045755311847,
		1 , 0 , -1 ,   1.84655399446452461731382754805963486433  , -0.99899725654578785949411212641280144453,
		1 , 0  ,-1 ,   1.847112729127505792448005195183213800192 , -0.998999017113030740588897060661111027002,
		1 , 0 , -1 ,   1.846615236930288617145379248540848493576 , -0.998761775277331564915073158772429451346
};
float IIR_BUF[10*7];

double IIR_SCALE =0.000619377221092000992269666070910716371*
		0.000619377221092000992269666070910716371*
		0.000619185532790996503819946905622373379*
		0.000619185532790996503819946905622373379*
		0.000619112361334273595715738114364512512;
uint16_t STAGE = 5;



arm_biquad_casd_df1_inst_f32 IIR_STRUCT;


void iir_init()
{
	arm_biquad_cascade_df1_init_f32(&IIR_STRUCT, STAGE, PARA,IIR_BUF);
}

void iir_Do(float *Input,float *Output,uint32_t len)
{
	float Buf[len];
	arm_biquad_cascade_df1_f32(&IIR_STRUCT, Input, Buf, len);
	arm_scale_f32(Buf, IIR_SCALE, Output, len);
}
void iir_Do_Realtime(float *Input,float *Output)
{
	float Buf;
	arm_biquad_cascade_df1_f32(&IIR_STRUCT, Input, &Buf, 1);
	arm_scale_f32(&Buf, IIR_SCALE, Output, 1);
}

